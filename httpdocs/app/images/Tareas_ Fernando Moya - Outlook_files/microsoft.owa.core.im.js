try { window.scriptsLoaded = window.scriptsLoaded || {}; window.scriptProcessStart = window.scriptProcessStart || {}; window.scriptProcessStart['microsoft.owa.core.im.js'] = (new Date()).getTime();
Type.registerNamespace("_im");_im.n=function(n){_im.n.initializeBase(this);this.b=n};_im.n.prototype={b:null,u:function(n){this.b.d(1);n.dc(this.b.b(),null,this.r,this.q)},cy:function(n,t,i){if(n===-9){_js.Trace.logInfo(_a.a.k,"AcceptChatAction.ProcessResult: Suppressing 'ConversationEnded' error.");n=this.b.b()}if(n<0){i(Error.create("InstantMessageOperationError: "+n));return}this.b.d(3);_js.Trace.logInfo(_a.a.k,"AcceptChatSession web service call succeeded for chat {0}.",this.b.b());t()},H:function(){_a.cX.prototype.H.call(this)}};_im.o=function(n,t){this.j=n;this.k=t};_im.o.prototype={k:null,j:null,a:function(n,t){return this.j.d(n,t)},b:function(n,t){return this.j.c(n,t)},g:function(n,t){return null},h:function(n,t){return null},i:function(n,t){return new _im.C(n,t)},f:function(n){return this.k.b(n)}};_im.u=function(n,t){_im.u.initializeBase(this);this.b=n;this.c=t};_im.u.prototype={b:null,c:null,F:function(){_a.cX.prototype.F.call(this);this.c.q(this.b)},u:function(n){if(this.b.b()===-1){this.b.d(4);return}n.hb(this.b.b(),null,this.r,this.q)},cy:function(n,t,i){this.b.d(4);if(!n){i(Error.create("EndChatAction returned false."));return}t()}};_im.v=function(n){this.a=n};_im.v.prototype={a:null,b:function(n){return new _im.u(n,this.a)}};_im.w=function(n){_im.w.initializeBase(this);_a.b.j(n,"sipUris");this.b=n};_im.w.prototype={b:null,u:function(n){n.eW(this.b,null,this.r,this.q)},cy:function(n,t,i){if(n<0){i(Error.create("GetPresenceAction failed with InstantMessageOperationError: "+n));return}t()}};_im.x=function(n){_im.x.initializeBase(this);this.b=n};_im.x.prototype={b:!1,u:function(n){var t;var i=(t=new _gg.yj(this.x),t.isAutomated=!this.b,t);n.fo(this.b,i,this.r,this.q)},cy:function(n,t,i){if(n<0){n!==-2&&_js.Trace.logInfo(_a.a.k,"Sign in failed with code {0}, will retry.",n);i(Error.create("InstantMessageOperationError: "+n));return}t()}};_im.y=function(n){_im.y.initializeBase(this);this.b=n};_im.y.prototype={b:!1,u:function(n){n.fp(this.b,null,this.r,this.q)},cy:function(n,t,i){if(n<0){i(Error.create("InstantMessageOperationError: "+n));return}t()}};_im.B=function(){_im.B.initializeBase(this)};_im.B.prototype={u:function(n){n.cA(null,this.r,this.q)},cy:function(n,t,i){if(n<0){i(Error.create("ResetPresenceAction failed with InstantMessageOperationError: "+n));return}t()}};_im.C=function(n,t){_im.C.initializeBase(this);this.b=n;this.c=t};_im.C.prototype={c:null,b:null,F:function(){_a.cX.prototype.F.call(this)},u:function(n){this.b.I()||this.b.d(1);var t=new _g.fc(this.c);t.ChatSessionId=this.b.b();t.Recipients=this.b.V();t.Subject=this.b.m();n.cF(t,null,this.r,this.q)},cy:function(n,t,i){if(n<0){i(Error.create("InstantMessageOperationError: "+n));return}this.b.o(n);this.b.d(3);t()},H:function(){this.b.q(_nbs.a.Op);_a.cX.prototype.H.call(this)}};_im.D=function(n,t){_im.D.initializeBase(this);_a.b.c(n,"sipUri");this.c=n;this.b=t};_im.D.prototype={c:null,b:"None",u:function(n){var t=new _gg.jM;t.Presence=this.b;n.cM(t,null,this.r,this.q)},cy:function(n,t,i){var r=n;if(r){i(Error.create("SetPresenceAction failed with InstantMessageOperationError: "+r));return}t()}};_im.l=function(n,t,i,r,u){_im.l.initializeBase(this);_a.b.a(i,"participants");_a.b.h(i.y.length,0,"participants.Count");if(!$a(u)){if(i.y.length!==1)throw Error.invalidOperation("imAddress can only be used in conjunction with a single participant.");if(!$a(r))throw Error.invalidOperation("imAddress and itemOrConversation are mutually exclusive.");}this.b=n;this.a=this.f(i);_a.b.h(this.a.y.length,0,"No valid participants.");this.e=t;this.d=r;this.c=u};_im.l.prototype={b:null,e:null,a:null,d:null,c:null,F:function(){_a.cX.prototype.F.call(this);if(!$a(this.e)){this.e.a(this.a,this.d,this.c);return}this.b.v(this.a,this.d,this.c)},O:function(){return 0},f:function(n){for(var u=new _js.f,f={},e=n.y.length,i=0;i<e;i++){var t=n.y[i];if(t&&this.b.a(t.g())){var r=t.g();if(!(r in f)){u.a(t);f[r]=t}}}return u}};_im.m=function(n,t){this.a=n;this.b=t};_im.m.prototype={a:null,b:null,d:function(n,t){return new _im.l(this.a,this.b,n,t,null)},c:function(n,t){var i=new _js.f;i.a(n);return new _im.l(this.a,this.b,i,null,t)}};_im.E=function(n){_im.E.initializeBase(this);_a.b.j(n,"sipUris");this.b=n};_im.E.prototype={b:null,u:function(n){n.gR(this.b,null,this.r,this.q)},cy:function(n,t,i){if(n<0){i(Error.create("SubscribeForPresenceUpdatesAction failed with InstantMessageOperationError: "+n));return}t()}};_im.F=function(n){_im.F.initializeBase(this);_a.b.c(n,"sipUri");this.b=n};_im.F.prototype={b:null,u:function(n){n.hc(this.b,null,this.r,this.q)},cy:function(n,t,i){if(n<0){i(Error.create("UnsubscribeFromPresenceUpdatesAction failed with InstantMessageOperationError: "+n));return}t()}};_im.p=function(n){this.b=n.a/1e3;this.a={}};_im.p.prototype={b:0,a:null,e:function(n){this.c();this.a[n.toString()]=this.d()},f:function(n){this.c();return n.toString()in this.a},d:function(){return _a.c.a()},c:function(){var s=this.d();var u=new _ff.d;var f=this.a;for(var r in f){var i={key:r,value:f[r]};var h=i.value;var c=h.B(this.b);c.b(s)<0&&u.c(i.key)}for(var t=u.h(),o=t.length,n=0;n<o;++n){var e=t[n];delete this.a[e]}}};_im.a=function(n,t,i,r,u,f,e){this.R=Function.createDelegate(this,this.bD);this.bg=Function.createDelegate(this,this.cd);this.bh=Function.createDelegate(this,this.ce);this.bb=Function.createDelegate(this,this.bW);this.bm=Function.createDelegate(this,this.ck);this.Y=Function.createDelegate(this,this.V);this.S=Function.createDelegate(this,this.bV);this.bc=Function.createDelegate(this,this.bY);this.bd=Function.createDelegate(this,this.bZ);this.be=Function.createDelegate(this,this.ca);this.bf=Function.createDelegate(this,this.cb);this.bi=Function.createDelegate(this,this.cf);this.bj=Function.createDelegate(this,this.ch);this.Z=Function.createDelegate(this,this.bS);this.ba=Function.createDelegate(this,this.bT);this.bo=Function.createDelegate(this,this.cl);this.A=new _js.f;this.D=new _js.f;this.G=new _js.f;_im.a.initializeBase(this);this.h("Initialization","unknown");this.z=t;this.br(this.z.c);if(!n){this.h("Initialization","Disabled");return}this.C=i;this.E=!0;this.H=!1;this.N=new _im.p(_a.cn.b(30));var s=new _g.bc;s.NotificationType="InstantMessageNotification";this.Q=new _h.K(s,this.C,r);this.Q.w(this.bo);if(u&&e){this.W=!0;_js.Trace.logInfo(_a.a.k,"ChatManager: Waiting for the pending-get activation event.");var o=this;u.b(_a.da,function(n){_js.Trace.logInfo(_a.a.k,"ChatManager: Pending-get activated.");o.O=!0;o.bC()});var h=this;u.b(_a.ef,function(){h.bp()});u.b(_a.cH,this.ba);f?this.bQ(f):this.y="Disabled"}this.A.d(this.Z);this.I=this.bG(this.C)};_im.a.d=function(n,t,i){var r;var f,u;if(u=n.O(function(n){return n.b()===t},f={val:r}),r=f.val,u){i.val=r;return!0}i.val=null;return!1};_im.a.e=function(n,t,i){var r;var f,u;var e=(u=n.O(function(n){var i=n;if(i.a().y.length!==1)return!1;var r=i.a().y[0];return r.g()===t?!0:!1},f={val:r}),r=f.val,u);i.val=r;return e};_im.a.prototype={z:null,W:!1,T:null,K:null,O:!1,M:!1,X:!1,N:null,C:null,L:!1,E:!1,P:!1,y:"unknown",F:null,H:!1,Q:null,I:null,br:function(n){this.bt(_im.a.a,n)},bA:function(n){this.bJ(_im.a.a,n)},d:function(){return this.y},b:function(){return this.y==="SignedIn"},f:function(){this.bu("IsEnabled");return this.y!=="Disabled"},j:function(){return this.A},l:function(){return this.D},k:function(){return this.G},m:function(){return this.X},e:function(){this.bu("CurrentUserSipUri");return this.K},t:function(n){if(!this.O){_js.Trace.logInfo(_a.a.k,"Ignoring a SignIn attempt because the pending-get connection is not yet started.");return}this.E=!0;this.H=n;this.V()},u:function(n){_js.Trace.logInfo(_a.a.k,"Signing out.");var t=new _im.y(n);t.w(this.bj);t.v(this.bi);this.h("SignOut:Manual="+n,"AttemptingSignOut");this.C.a(t)},g:function(n,t,i){var f=_im.b.a(t);var e;var r,u;var o=(u=this.z.f(f,r={val:e}),e=r.val,u);this.bL(n,f,_im.b.b(i),o)},w:function(n,t){var i=new _im.D(_im.b.a(n),t);i.w(this.bf);i.v(this.be);this.C.a(i)},h:function(n,t){t==="Error";_js.Trace.logInfo(_a.a.k,"SignInState: {0} Requesting change from {1} to {2}",n,this.y,t);var i=this.b();if(this.y!==t){this.y=t;this.bk(_im.a.b);this.b()!==i&&this.bk(_im.a.c)}},x:function(n,t){_js.Trace.logInfo(_a.a.k,"Setting current user SIP URI to {0}",t);this.K=t},r:function(){if(this.y==="SignedIn"){_js.Trace.logInfo(_a.a.k,"ResetPresence");var n=new _im.B;n.w(this.bd);n.v(this.bc);this.C.a(n)}},v:function(n,t,i){_js.Trace.logInfo(_a.a.k,"Starting chat.");_a.b.b(n,"basePersonaParticipants");_a.b.h(n.y.length,0,"basePersonaParticipants.Count");$a(i)||_a.b.f(n.y.length,1,"When imAddress is specified, participant count must be 1.");for(var u=new _js.f,w=n.y.length,o=0;o<w;o++){var y=n.y[o];var p=_pc.a.c(y);u.a(p)}var r=null;if(u.y.length===1){var e=u.y[0];var f=null;$a(i)?$a(e.g())||(f=e.g()):f=i;if(!$a(f)){var h,s;s=_im.a.e(this.A,f,h={val:r}),r=h.val,s}var c=e.c();if(!_js.d.b(f)&&!_js.d.b(c)){var v=_im.b.a(f);this.z.d("StartChat (single participant)",v,c,e.ds,!0)}}else{var l=this;u.q(function(n){var t=n;var r=t.g();var i=t.c();if(!_js.d.b(r)&&!_js.d.b(i)){var u=_im.b.a(r);l.z.d("StartChat (multiple participants)",u,i,t.ds,!0)}})}if(!r){r=this.bv(u,t);this.bq(r);if(!$a(i)){var a=u.y[0];r.bb(a,i)}}_g.h.isInstanceOfType(t)?r.P(t):_g.y.isInstanceOfType(t)&&r.O(t);return r},i:function(n){_js.Trace.logInfo(_a.a.k,"Accepting invitation.");this.D.m(n,!0);this.bq(n);var t=new _im.n(n);this.C.a(t)},p:function(n){_js.Trace.logInfo(_a.a.k,"Ignoring invitation.");this.D.m(n,!0);this.N.e(n.b())},q:function(n){_js.Trace.logInfo(_a.a.k,"Removing chat {0}",n.b());n.d(4);n.a().e(this.S);var i=this.A.m(n,!0);var t=this.D.m(n,!0);$a(n.c())||_h.e.a().c(n.c().Id)},bW:function(n){if(n.EventType==="Reload"){_js.Trace.logWarning(_a.a.k,"ChatManager.OnIMNotification: Received a 'Reload' notification from the OWA server, assuming server has rebooted or connection re-established");this.E=!0;this.J(!1);return}var t=n;var i=t.PayloadType;if($a(i)){_js.Trace.logWarning(_a.a.k,"ChatManager.OnIMNotification: Unexpected notification payload: {0}, {1}",n.EventType,n.toString());return}if(i==="ServiceUnavailable"){if(t.ServiceError==="ClientSignOut"){_js.Trace.logWarning(_a.a.k,"ChatManager.OnIMNotification: Service unavailable, client signed out.  {0}",t.ErrorMessage);this.h("IMNotification","SignedOut");return}_js.Trace.logWarning(_a.a.k,"ChatManager.OnIMNotification: Received a 'ServiceUnavailable' notification: {0}, {1}.",t.ServiceError,t.ErrorMessage);this.J(!1);return}if(i==="SignOn")if(t.SignOnStarted){_js.Trace.logInfo(_a.a.k,"ChatManager.OnIMNotification: Sign-on started.");return}else{_js.Trace.logInfo(_a.a.k,"ChatManager.OnIMNotification: Sign-on succeeded.");this.J(!0);this.cc();this.X=t.IsUserInUcsMode;return}if(i==="UpdateUserPresence"||i==="UserPresenceChange"||i==="QueryUserPresenceChange"){this.bK(t);return}this.z.l(t);!$a(t.Persona)&&$a(t.Persona.ImAddress)&&(t.Persona.ImAddress=t.SipUri);if(t.PayloadType==="PendingContactList"){if($a(t.PendingContacts)){_js.Trace.logWarning(_a.a.bH,"The payload for PendingContacts is empty");return}this.bE(t.PendingContacts);return}if(t.PayloadType==="AddToBuddyList"){if($a(t.AddedContacts)){_js.Trace.logWarning(_a.a.bH,"The payload for AddedContacts is empty");return}this.cj(t.AddedContacts)&&_js.Trace.logInfo(_a.a.bH,"Removed already added contact from pending buddyRequests");return}if(t.PayloadType==="EmptySubscribers"){this.bI();_js.Trace.logInfo(_a.a.bH,"Removed already added contact from pending buddyRequests after receiving emptysubscribers");return}if(!("ChatSessionId"in t)){_js.Trace.logInfo(_a.a.k,"Notification {0} not supported, no session id.",i);return}if(this.N.f(t.ChatSessionId)){_js.Trace.logInfo(_a.a.k,"ChatManager.OnIMNotification: {0} for conversation {1} was ignored.",t.PayloadType,t.ChatSessionId);return}_js.Trace.logInfo(_a.a.k,"ChatManager.OnIMNotification: {0}, Session={1}, SipUri={2}",i,t.ChatSessionId,t.SipUri);var r;var e,o,u,f;if((o=_im.a.d(this.A,t.ChatSessionId,e={val:r}),r=e.val,o)||(f=_im.a.d(this.D,t.ChatSessionId,u={val:r}),r=u.val,f)){var s=this.z.b(t.SipUri,t.DisplayName);this.ci(t,r,s);return}_js.Trace.logInfo(_a.a.k,"No matching chat found for session {0}",t.ChatSessionId);this.cm(t)},c:function(n){for(var r=n.b(),t=0;t<r;t++){var i=n.a(t);if(i&&this.a(i.SipUri))return!0}return!1},a:function(n){return _js.d.b(n)?!1:_js.d.b(this.e())?!1:n.toLowerCase()===this.e().toLowerCase()?!1:!0},n:function(n){return _im.b.b(n)},o:function(n){return _im.b.d(n)},bG:function(n){return new _im.A(n)},bH:function(){this.h("DelayInternalSignIn","AttemptingSignIn");_js.g.a().a(_a.a.k,"ChatManager.InternalSignIn",this.Y,3e4)},bl:function(){this.bA(this.z.c);_js.u.prototype.bl.call(this)},ce:function(n){_js.Trace.logInfo(_a.a.k,"Sign-in action succeeded.  Awaiting notification.");this.F=_js.g.a().a(_a.a.k,"ChatManager.SignInNotificationTimeout",this.bm,1e4)},cd:function(n){_js.Trace.logInfo(_a.a.k,"Sign-in action failed.");var t=n;if(t.A===-11){_js.Trace.logInfo(_a.a.k,"Automatic sign-in rejected because the user was explicitly signed out.");this.h("Automatic Sign-In Rejected","SignedOut");return}_js.Trace.logWarning(_a.a.k,"Sign-in failed: {0}",t.t.message);this.J(!1)},ck:function(){_js.Trace.logWarning(_a.a.k,"Sign-in timeout expired.  Current sign-in state: {0}, ServiceAvailable: {1}.",this.y,this.L);this.y!=="SignedIn"&&this.J(!1)},ch:function(n){_js.Trace.logInfo(_a.a.k,"Sign-out succeeded.");this.h("SignOutSucceeded","SignedOut")},cl:function(n,t){if(!this.P){_js.Trace.logInfo(_a.a.k,"Subscribed to notifications.");this.P=!0;this.V()}},bR:function(n,t,i){if(this.y!=="Disabled"){var r=n?"SignedOut":"Disabled";if(_js.d.a(i)){_js.Trace.logInfo(_a.a.k,"The currentUserSipUri is null/empty -> Marking SignInState as disabled.");r="Disabled"}else i=_im.b.a(i);this.h("Configuration Updated",r)}this.T=t;this.x("InternalSetConfiguration",i);this.M=!0},V:function(){if(!this.P){_js.Trace.logInfo(_a.a.k,"Subscribing to notifications.");this.Q.l(_a.a.k,"OnIMNotification",this.bb,1);return}_js.Trace.logInfo(_a.a.k,"Signing in. Manual: {0}, will retry: {1}",this.H,this.E);var n=new _im.x(this.H);n.w(this.bh);n.v(this.bg);this.h("InternalSignIn","AttemptingSignIn");this.C.a(n);this.F&&(this.F=_js.g.a().b(this.F))},bv:function(n,t){_js.Trace.logInfo(_a.a.k,"Creating new Chat.");var i=new _h.f(!0);i.a().d(this.S);i.a().C(n);i.N(new _g.g("IM:"+Math.random().toString()));if(!t)return i;if(_g.h.isInstanceOfType(t)){i.P(t);return i}if(_g.y.isInstanceOfType(t)){i.O(t);return i}var r=_js.d.c("CreateChat: itemOrConversation type {0} is not supported.",Object.getType(t).getName());_js.Trace.logError(_a.a.k,r);throw Error.invalidOperation(r);},bq:function(n){_js.Trace.logInfo(_a.a.k,"Activating chat.");$a(n.c())||_h.e.a().b(n.c().Id,n);var t=this.bN(n);this.A.u(t,n)},ci:function(n,t,i){var u=n.PayloadType;switch(u){case"NewChatMessageToast":_js.Trace.logInfo(_a.a.k,"NewChatMessageToast received and mapped to chat {0}.",t.b());return;case"ParticipantJoined":this.z.e(n);var r;if($a(n.Persona))r=_pc.a.j(i,n.SipUri);else{r=new _pc.a(null,!0,null);r.dW(n.Persona)}t.X(n.SipUri,r,i);return;case"ParticipantLeft":t.Y(n.SipUri,i);return;case"EndChatSession":t.v||this.D.m(t,!0);return;case"NewChatMessage":t.L(i,n.MessageContent);return;case"UserActivity":switch(n.UserActivity){case"FailedDelivery":t.q(_nbs.a.Op);return;case"Typing":t.bf(i);return;case"StoppedTyping":t.e("");return;case"TwoOrMoreTyping":t.e(_nbs.a.PH);return;case"DeliveryTimeout":t.q(_nbs.a.bA);return;default:return}}},cm:function(n){if(n.PayloadType==="NewChatMessageToast"){this.z.e(n);var r=this.z.b(n.SipUri,n.DisplayName);var u=this.bw(n.Persona,r,n.SipUri,n.ToastMessage,n.MessageSubject,n.ChatSessionId);_js.Trace.logInfo(_a.a.k,"ChatManager.TryProcessInvitation: Created invitation for conversation {0} (NewChatMessageToast).",n.ChatSessionId);return!0}if(n.PayloadType==="NewChatMessage"){var t=this.z.b(n.SipUri,n.DisplayName);var i=this.bw(n.Persona,t,n.SipUri,n.MessageContent,"",n.ChatSessionId);i.L(t,n.MessageContent);_js.Trace.logInfo(_a.a.k,"ChatManager.TryProcessInvitation: Created invitation for conversation {0} (NewChatMessage).",n.ChatSessionId);return!0}return!1},bw:function(n,t,i,r,u,f){var o;if($a(n))o=_pc.a.j(t,i);else{o=new _pc.a(null,!0,null);o.dW(n)}$a(r)&&(r="");var s=new _js.f;s.a(o);var e=this.bv(s,null);e.o(f);e.j=o;e.r=r;_js.d.b(u)||e.z(u);this.D.a(e);return e},bE:function(n){_a.b.b(n,"senderInfo");for(var u=n,e=u.length,r=0;r<e;++r){var t=u[r];var i=t.SipUri;_js.Trace.logInfo(_a.a.bH,"Adding pending contact to buddy requests list",i);var f=this.bO(t.DisplayName,t.Title,i);this.bz(i,!1)||this.G.a(f)}},cj:function(n){_a.b.b(n,"senderInfo");for(var r=!1,u=n,f=u.length,t=0;t<f;++t){var e=u[t];var i=e.SipUri;_js.Trace.logInfo(_a.a.bH,"Examining the AddToBuddyList payload for existing buddy requests",i);r=this.bz(i,!0)}return r},bI:function(){_js.Trace.logInfo(_a.a.bH,"Received empty subscribers notification, we need to hide the pending buddy dialogue");this.G.g()},bO:function(n,t,i){_a.b.b(n,"displayName");_a.b.b(i,"buddyImAddress");var r=_pc.a.j(n,i);_js.d.a(t)||r.fT(t);return r},bz:function(n,t){for(var i=0;i<this.G.y.length;i++){var r=this.G.y[i];if(!r.g().localeCompare(n)){if(t){_js.Trace.logInfo(_a.a.bH,"Removing already added contact from pending buddyRequests",r.g());this.G.o(i)}return!0}}return!1},bN:function(n){var t=this;return this.A.k(function(t){return n.g.b(t.g)>=0})},J:function(n){this.F&&(this.F=_js.g.a().b(this.F));var t=this.L;this.L=n;if(n&&t){_js.Trace.logInfo(_a.a.k,"Service confirmed available.");return}else if(n&&!t){_js.Trace.logInfo(_a.a.k,"Service resumed.");return}else if(!n&&t){_js.Trace.logInfo(_a.a.k,"Service interrupted.");this.bp();this.bB();return}else if(!n&&!t){_js.Trace.logInfo(_a.a.k,"Service confirmed unavailable.");this.bB();return}_js.Trace.logError(_a.a.k,"Unexpected condition in ChatManager.SetServiceAvailability.")},cc:function(){this.h("SignedOn Succeeded","SignedIn");this.E=!0;this.H=!1},bp:function(){this.A.q(this.R);this.D.q(this.R);var n=this;this.A.q(function(t){t.bd(n.L)})},bB:function(){if(this.y==="AttemptingSignIn"||this.y==="SignedIn"||this.y==="Error"){if(this.E){this.E=!1;this.bH();return}this.H=!1;this.h("SignIn-GiveUp","Error")}},cf:function(n){_js.Trace.logWarning(_a.a.k,"Sign-out failed: {0}",n.t.message);this.h("SignOutFailed","SignedOut")},bZ:function(n){_js.Trace.logInfo(_a.a.k,"Reset presence succeeded.")},bY:function(n){_js.Trace.logWarning(_a.a.k,"Reset presence failed: {1}",n.t.message)},cb:function(n){var t=n;_js.Trace.logInfo(_a.a.k,"Set presence to {0} succeeded.",t.b)},ca:function(n){var t=n;_js.Trace.logWarning(_a.a.k,"Set presence to {0} failed: {1}",t.b,n.t.message)},bD:function(n){var t=n;t.o(-2);t.be()},bL:function(n,t,i,r){var f=this.z.b(t,null);var e=new _im.g(n,t,f,i,r);var u=this.go(_im.a.a);u&&u(e)},bK:function(n){var u=this.go(_im.a.a);if(u){var e=n.PayloadType;if(n.PayloadType==="UpdateUserPresence"){var r=n.DisplayName;_js.d.b(r)&&(r=this.T);var s=new _im.g(e,this.K,r,_im.b.b(n.NewUserPresence),!0);u(s);return}if(!$a(n.UserPresenceChanges))for(var h=n.PayloadType!=="QueryUserPresenceChange",f=n.UserPresenceChanges,c=f.length,i=0;i<c;++i){var t=f[i];var o=new _im.g(e,t.SipUri,t.UserName,_im.b.b(t.Presence),h);u(o)}}},bV:function(n,t){switch(t.c){case 0:var f=t.a;var e=this.by(f);this.I.i(e);break;case 2:var u=t.b;var i=this.by(u);var r=this.bx(i);this.I.j(r);break;case 1:case 3:default:_a.b.d(!1,"Unexpected notification received: "+t.c);break}},by:function(n){var r=new _ff.d;if(n)for(var i=n,f=i.length,t=0;t<f;++t){var u=i[t];this.bs(r,u)}return r},bx:function(n){for(var f=this.U(this.A.f()),u=new _ff.d,r=n.d,e=r.length,t=0;t<e;++t){var i=r[t];f.g(i)||u.c(i)}return u},bS:function(n,t){switch(t.c){case 0:var f=t.a;var e=this.U(f);this.I.i(e);break;case 2:var u=t.b;var i=this.U(u);var r=this.bx(i);this.I.j(r);break;case 1:case 3:default:_a.b.d(!1,"Unexpected notification received: "+t.c);break}},U:function(n){var r=new _ff.d;if(n)for(var u=n,e=u.length,t=0;t<e;++t){var o=u[t];var i=o;if(i.a()){var f=this;i.a().q(function(n){f.bs(r,n)})}}return r},bs:function(n,t){var r=t;var i=_im.b.a(r.g());i.localeCompare(this.K)&&(n.g(i)||n.c(i))},bu:function(n){this.W&&(this.y==="unknown"||!this.M)&&_js.Trace.logError(_a.a.k,"ChatManager: Do not access {0} until configuration has loaded.",n)},bC:function(){if(this.f()&&this.O&&this.M){var n=this;_js.g.a().a(_a.a.k,"ChatManager.SignIn",function(){n.t(!1)},5e3)}},bQ:function(n){var r=n.e().bh.InstantMessage;var i=n.c().bh.UserDisplayName;var t=n.c().bh.UserSipUri;this.bR(r,i,t);this.bC()},bT:function(n){if(!n.a){this.E=!1;this.J(!1)}}};_im.q=function(n,t,i,r,u,f,e){this.e=n;this.g=t;this.c=i;this.h=r;this.d=u;this.i=f;this.f=e};_im.q.prototype={e:!1,g:null,c:null,h:null,d:null,i:null,f:!1,b:null,a:function(){this.b||(this.b=new _im.a(this.e,this.g,this.c,this.h,this.d,this.i.e(),this.f));return this.b}};_im.e=function(){this.c=Function.createDelegate(this,this.m);_im.e.initializeBase(this);this.a={}};_im.e.prototype={a:null,k:function(){var t=this.a;for(var n in t){var r={key:n,value:t[n]};var i=r.value;i.d(0)}},l:function(n){this.h(n,!1)},e:function(n){this.h(n,!0)},m:function(n){this.d(n.e,n.b,n.c,n.a,n.d)},d:function(n,t,i,r,u){this.g(n,t,i,u);this.j(n,t,r,u)},b:function(n,t){var i=t;if(_js.d.b(i)&&!_js.d.b(n)){n=_im.b.a(n);var r=this.a[n];$a(r)||(i=r.a);_js.d.b(i)&&(i=_im.b.c(n))}return i},f:function(n,t){t.val=0;n=_im.b.a(n);var i=this.a[n];if($a(i))return!1;t.val=i.b;return!0},h:function(n,t){if(!_js.d.b(n.SipUri)){this.g(n.PayloadType,n.SipUri,n.DisplayName,t);if(!$a(n.NewUserPresence)){var i=_im.b.b(n.NewUserPresence);this.j(n.PayloadType,n.SipUri,i,t)}}},g:function(n,t,i,r){var u=this;this.i(n,t,r,function(n){_js.d.b(i)||n.e(i)})},j:function(n,t,i,r){var u=this;this.i(n,t,r,function(n){$a(i)||n.d(i)})},i:function(n,t,i,r){t=_im.b.a(t);var u=this.a[t];if($a(u)){if(!i)return;u=new _im.r(t);this.a[t]=u}r(u)}};_im.r=function(n){_im.r.initializeBase(this);_a.b.c(n,"sipUri");this.c=n};_im.r.prototype={c:null,a:null,b:0,e:function(n){if(this.a===n)return n;this.a=n;this.bk("DisplayName");return n},d:function(n){if(this.b===n)return n;this.b=n;this.bk("Presence");return n},toString:function(){return String.format("SipUri: {0}, DisplayName: {1}, Presence: {2}",this.c,$a(this.a)?"":this.a,this.b)}};_im.s=function(n,t,i,r){this.l=Function.createDelegate(this,this.o);this.f=n;this.m=t;this.i=i;this.h=r;this.i.d(this.l);this.h.d(this.l)};_im.s.prototype={m:null,i:null,h:null,f:!1,g:null,k:!1,n:0,b:function(n){if(n&&this.f){if(this.j()){n();return}this.g||(this.g=new Sys.EventHandlerList);this.g.addHandler("chatInitialized",n)}},a:function(){return this.j()&&this.f?this.m:null},e:function(){return this.j()&&this.f?this.i.b():null},d:function(){return this.j()&&this.f?this.h.b():null},c:function(){return this.f},j:function(){if(!this.k&&this.f){this.i.a(null);this.h.a(null)}return this.k||!this.f},o:function(){this.n++;if(this.n===2){this.k=!0;if(this.g){this.g.getHandler("chatInitialized")();this.g=null}}}};_im.t=function(n,t,i,r,u){this.e=n;this.d=t;this.g=i;this.c=r;this.f=u};_im.t.prototype={e:!1,d:null,g:null,c:null,f:0,b:null,a:function(){_a.b.f(this.f,"Mouse","ChatProviderFactory.Create - Layout");this.b||(this.b=new _im.s(this.e,this.d,this.g,this.c));return this.b}};_im.j=function(n,t,i){_im.j.initializeBase(this,[n,t,i]);_js.Trace.logInfo(_a.a.k,"PopOutPresenceManager.Ctor.")};_im.j.prototype={p:function(){return new _im.z(this.h)},q:function(n){this.o(n.b,n.a)},k:function(n){this.f.c(n)},s:function(){}};_im.z=function(n){_im.z.initializeBase(this,[n]);_js.Trace.logInfo(_a.a.k,"PopOutPresenceRequestsManager.Ctor")};_im.z.prototype={c:function(n){_a.b.c(n,"sipUri");this.d.queryPresenceInMainWindow(n)},j:function(n){_a.b.c(n,"sipUri");return!0},i:function(){}};_im.k=function(n,t,i){this.l=Function.createDelegate(this,this.t);this.m=Function.createDelegate(this,this.q);this.n=Function.createDelegate(this,this.u);this.d={};_im.k.initializeBase(this);_a.b.a(n,"chatManager");_a.b.a(t,"chatParticipantCache");_a.b.a(i,"presenceCrossWindowNotifier");this.e=n;this.i=t;this.e.apcl(_im.a.b,this.n);this.e.br(this.m);this.h=i;this.f=this.p();this.g=this.e.y;_js.Trace.logInfo(_a.a.bh,"PresenceManager.Ctor.")};_im.k.prototype={e:null,i:null,h:null,f:null,g:"unknown",j:function(){return this.e.y==="SignedIn"},c:function(n){_a.b.a(n,"persona");if(!this.e.f())return!1;_js.Trace.logInfo(_a.a.bh,"PresenceManager.TryRegisterForPresenceUpdates: Registering persona for presence updates: {0}, SIP:{1}",n.d(),n.g()||"");n.apcl("ImAddress",this.l);if(_js.d.b(n.g()))return!0;var t=_im.b.a(n.g());this.v(t,n);this.k(t);return!0},a:function(n){_a.b.a(n,"persona");_js.Trace.logInfo(_a.a.bh,"PresenceManager.TryUnregisterForPresenceUpdates: Unregistering persona for presence updates: {0}, SIP:{1}",n.d(),n.g()||"");return this.r(n,n.g())},b:function(n,t){_a.b.c(n,"sipUri");this.k(n);t.val=0;if(n in this.d){var i=this.d[n];if(i.b()>0){t.val=i.a(0).S();return!0}}return!1},p:function(){return new _im.f(this.h)},k:function(n){if(this.j()){var t;var r,i;(i=this.i.f(n,r={val:t}),t=r.val,i)&&this.o(n,t);n!==_im.b.a(this.e.e())&&this.f.c(n)}},q:function(n){if(this.j()){this.o(n.b,n.a);this.h.updatePresenceInAllPopOutWindows(n.b,n.a)}},o:function(n,t){n=_im.b.a(n);if(!(n in this.d))return!1;for(var r=this.d[n],i=0;i<r.b();i++){var u=r.a(i);u.o(t)}return!0},s:function(){this.h.updateSignInStateInAllPopOutWindows(this.g)},F:function(){_js.Trace.logInfo(_a.a.bh,"PresenceManager.InternalDispose.");this.e.rpcl(_im.a.b,this.n);this.e.bA(this.m);this.f.dispose();this.f=null},r:function(n,t){if(!this.e.f())return!1;n.rpcl("ImAddress",this.l);if(_js.d.b(t))return!1;var i=_im.b.a(t);if(!(i in this.d))return!1;var r=this.d[i];var u=r.p(n);if(!r.b()){delete this.d[i];this.f.j(i)}return u},u:function(n,t){var a=n;var r=this.g;var y=r==="SignedIn";this.g=a.y;var s=this.j();if(y!==s)if(s){_js.Trace.logInfo(_a.a.bh,"PresenceManager.OnSignInStateChanged: OldSignInState: {0} to NewSignInState: {1}. Requesting presence for every persona active.",r,this.g);var e=this.d;for(var f in e){var c={key:f,value:e[f]};var l=c.key;this.k(l)}}else{_js.Trace.logInfo(_a.a.bh,"PresenceManager.OnSignInStateChanged: OldSignInState: {0} to NewSignInState: {1}. Resetting presence to Unknown everywhere.",r,this.g);var h=this.d;for(var o in h)for(var v={key:o,value:h[o]},u=v.value,i=0;i<u.b();i++)u.a(i).o(0);this.f.i();this.i.k()}this.s()},t:function(n,t){var i=n;var r=null;var e=this.d;for(var f in e){var u={key:f,value:e[f]};var s=u.key;var o=u.value;if(o.j(i)){r=s;break}}_js.Trace.logInfo(_a.a.bh,"PresenceManager.OnImAddressChangedForAPersona: Unregistering persona {0} for old IM Address {1}",i.d(),r);this.r(i,r);_js.Trace.logInfo(_a.a.bh,"PresenceManager.OnImAddressChangedForAPersona: Re-registering persona {0} for new IM Address {1}",i.d(),$a(i.g())?"":i.g());this.c(i)},v:function(n,t){n in this.d||(this.d[n]=new(_a.fJ.$$(_bc.z)));var i=this.d[n];if(!i.j(t)){i.c(t);i.b()>1?t.o(i.a(0).S()):this.j()||t.o(0)}}};_im.f=function(n){this.g=Function.createDelegate(this,this.m);this.e=Function.createDelegate(this,this.k);this.f=Function.createDelegate(this,this.l);this.a=new(_a.fJ.$$(String));_im.f.initializeBase(this);_a.b.b(n,"presenceCrossWindowNotifier");this.d=n;this.a.n(this.f);_js.Trace.logInfo(_a.a.bh,"PresenceRequestsManager.Ctor")};_im.f.prototype={d:null,b:null,c:function(n){_a.b.c(n,"sipUri");if(!this.a.j(n)){_js.Trace.logInfo(_a.a.bh,"PresenceRequestsManager.AddOrUpdatePendingGetRequests: Queuing a presence retrieval request for sip {0}",n);this.a.c(n)}},j:function(n){_a.b.c(n,"sipUri");return this.a.p(n)},i:function(){_js.Trace.logInfo(_a.a.bh,"PresenceRequestsManager.ClearAll: Clearing all pending get presence requests: {0}",this.a.b());this.a.m()},F:function(){_js.Trace.logInfo(_a.a.bh,"PresenceRequestsManager.InternalDispose.");this.h()},h:function(){if(this.b){_js.Trace.logInfo(_a.a.bh,"PresenceRequestsManager.CancelBatchGetPresenceRequestsTimer.");this.b=_js.g.a().b(this.b)}},m:function(){this.b=null;var t=this.a.f();var i=t.join("; ");this.a.m();var n=new _im.w(t);n.z(this.e);OwaApplication.a.a(n)},l:function(n,t){if(this.a.b()>0){if(!this.b){_js.Trace.logInfo(_a.a.bh,"PresenceRequestsManager.OnPendingGetPresenceRequestsCollectionChanged: Activating timer to run after {0}ms. Current count of pending requests = {1}",_im.f.a,this.a.b());this.b=_js.g.a().a(_a.a.bh,"GetPresence",this.g,_im.f.a)}}else{_js.Trace.logInfo(_a.a.bh,"PresenceRequestsManager.OnPendingGetPresenceRequestsCollectionChanged: Cancelling timer. Current count of pending requests = {0}",this.a.b());this.h()}},k:function(n){var t=n;var i=t.b.join("; ");if(t.t){_js.Trace.logWarning(_a.a.bh,"PresenceRequestsManager.OnGetPresenceActionCompleted: Failed with {0} for {1} SipUris: '{2}'",t.t,this.a.b(),i);return}}};_im.A=function(n){this.h=Function.createDelegate(this,this.n);this.f=Function.createDelegate(this,this.l);this.g=Function.createDelegate(this,this.m);this.d=n;this.b=new _ff.d;this.c=new _ff.d;this.a=new _ff.d};_im.A.prototype={d:null,b:null,c:null,a:null,e:!1,i:function(n){for(var i=new _ff.d,f=n.d,e=f.length,r=0;r<e;++r){var t=f[r];if(this.a.g(t)){this.a.n(t);continue}this.c.g(t)||this.b.g(t)||i.g(t)||i.c(t)}if(i.d.length>0){this.b.i(i.d);var u=new _im.E(i.d);u.w(this.g);u.v(this.f);this.d.a(u)}},j:function(n){for(var i=0;i<n.d.length;i++){var t=n.d[i];if(this.b.g(t)){this.b.n(t);continue}this.a.g(t)||this.c.g(t)&&this.a.c(t)}this.k()},k:function(){if(this.a.d.length&&!this.e){this.e=!0;var t=this.a.d[0];this.a.j(0);this.c.n(t);var n=new _im.F(t);n.z(this.h);this.d.a(n)}},n:function(n){this.e=!1;this.k()},m:function(n){for(var f=n,r=f.b,u=r.length,t=0;t<u;++t){var i=r[t];this.c.g(i)||this.c.c(i);this.b.n(i)}_js.Trace.logInfo(_a.a.k,"SubscribeForPresenceUpdates: succeeded.")},l:function(n){for(var r=n,i=r.b,e=i.length,t=0;t<e;++t){var f=i[t];this.b.n(f)}var u=r.b.join(";");_js.Trace.logInfo(_a.a.k,"SubscribeForPresenceUpdates: failed to subscribe for: {0}.",u)}};_im.g=function(n,t,i,r,u){_a.b.c(n,"source");_a.b.c(t,"sipUri");this.e=n;this.b=t;this.c=i;this.a=r;this.d=u};_im.g.prototype={e:null,b:null,c:null,a:0,d:!1,toString:function(){return String.format("Source: {0}, Sip: {1}, DisplayName: {2}, Presence: {3}, IsAboutMeOrMyBuddy: {4}",this.e,this.b,$a(this.c)?"":this.c,this.a,this.d)}};_im.b=function(){};_im.b.b=function(n){switch(n){case"Away":return 3;case"BeRightBack":return 3;case"Busy":return 4;case"DoNotDisturb":return 6;case"IdleBusy":return 4;case"IdleOnline":return 2;case"None":return 0;case"Offline":return 1;case"Online":return 2;default:return 0}};_im.b.d=function(n){switch(n){case 2:return"Online";case 3:return"Away";case 5:return"IdleBusy";case 4:return"Busy";case 6:return"DoNotDisturb";case 1:return"Offline";case 0:default:return"None"}};_im.b.a=function(n){_a.b.c(n,"imAddress");var t=n.toLowerCase();t.startsWith("sip:")||(t="sip:"+t);return t};_im.b.c=function(n){_a.b.c(n,"imAddress");var t=n.toLowerCase();t.startsWith("sip:")&&(t=t.substr(4));return t};function IMComponent(){}IMComponent.$$cctor=function(){_a.r.a().a(IMComponent)};IMComponent.prototype={a:function(n,t,i){n.e(_im.e).a();var h=this;n.b(_h.dx,function(){return new _im.G(n.a(_y.M))}).a();var s=this;n.b(IChatManagerFactory,function(){var t=i.a()==="Mouse"&&!_a.bU.a();return new _im.q(t,n.a(_im.e),n.a(_a.s),null,n.a(_ff.c),n.f(_g.f),i.f())}).a();var c=this;n.b(_im.a,function(){return n.a(IChatManagerFactory).a()}).a();var a=this;n.b(IChatActionFactory,function(){var t;t=i.k()?new _im.m(n.a(_im.a),n.a(_h.dx)):new _im.m(n.a(_im.a),null);return new _im.o(t,new _im.v(n.a(_im.a)))}).a();var l=this;n.b(_im.i,function(){return new _im.i(n.a(_y.a),n.a(_rw.h),n.a(_y.M))}).b(IChatViewModelFactory);if(i.k()){var r=this;n.b(_im.j,function(){return new _im.j(n.a(_im.a),n.a(_im.e),n.a(_y.M))}).b(IPresenceManager).a()}else{var u=this;n.b(_im.k,function(){return new _im.k(n.a(_im.a),n.a(_im.e),n.a(_y.M))}).b(IPresenceManager).a()}var f=this;n.b(IChatProviderFactory,function(){return new _im.t(i.a()==="Mouse"&&!_a.bU.a(),n.a(_im.a),n.d(IPresenceManager),n.d(IChatActionFactory),i.a())}).a();var o=this;n.b(_im.h,function(){return new _im.h(i.a(),n.a(_g.a).V(),n.a(_im.a),n.a(_im.i))}).a();var e=this;n.b(ILwxViewModel,function(){return null}).a()},b:function(){return[new _a.B(_im.h,2,1),new _a.B(_im.a,2,1)]}};_im.h=function(n,t,i,r){if(n==="Mouse"&&t){var u=this;i.j().d(function(n,t){if(!t.c)for(var i=0;i<t.a.length;i++){var u=t.a[i];r.f(u)}})}};_im.c=function(n,t,i,r){this.k=Function.createDelegate(this,this.m);this.h=Function.createDelegate(this,this.l);this.e=Function.createDelegate(this,this.n);this.i=Function.createDelegate(this,this.o);_im.c.initializeBase(this);this.d=r;this.a=n;this.g=new _C(this.i,_a.a.k);this.p(i.a(1,_bc.f.a,this.a.a(),2));this.a.a().d(this.e);t.k(this.h);if(r.get_mainWindowInstance()&&!r.get_mainWindowInstance().closed){var u=this;_a.P.a(r.get_mainWindowInstance(),function(n){n.chatWindowReady(u.a.p())})}};_im.c.prototype={d:null,a:null,g:null,f:null,b:function(){return this.ec(_im.c.a)},p:function(n){this.eb(_im.c.a,n);return n},j:function(n){this.f=n;this.ea("EditorCallContext");return n},c:function(){return this.ec(_im.c.b)},q:function(n){this.eb(_im.c.b,n);return n},n:function(n,t){switch(t.c){case 0:for(var r=0;r<t.a.length;r++){var f=t.a[r];this.b().n(f)}return;case 2:for(var i=t.b.length-1;i>=0;i--){var e=t.b[i];var o=this;var u=this.b().a().k(function(n){var t=n;return t.j.g()===e.g()});u<this.b().a().y.length&&this.b().a().o(u)}return}},o:function(){if(!_js.d.a(this.c())){this.a.bc(this.c());var n=this;_a.P.a(this.d.get_mainWindowInstance(),function(t){t.sendChatMessage(n.a.c().Id,n.c())})}},l:function(n){_js.Trace.logInfo(_a.a.k,"ChatViewModel.BeforeUnload invoked.");this.a.a().e(this.e);var t=this;_a.P.a(this.d.get_mainWindowInstance(),function(n){_js.Trace.logInfo(_a.a.k,"ChatViewModel.BeforeUnload calling into main window.");n.endChat(t.a.p())})},m:function(){this.j(new _cmc.c(!1))}};_im.i=function(n,t,i){this.c=n;this.e=t;this.d=i};_im.i.prototype={c:null,e:null,d:null,f:function(n){var r={};r.ItemID=n.J();var i=new _y.bJ;i.b(n);var t=_bc.c.e();if(n.E!==-1&&n.F!==-1){t.c=n.E;t.d=n.F}_js.Trace.logInfo(_a.a.k,"ChatViewModelFactory: Chat.BodyText: {0}",n.l());var u=this;this.c.g(IChatViewModelFactory,function(){return u},r,t,i,!1)},b:function(n,t,i){return null},a:function(n,t,i){var u=n.a();return new _im.c(u,this.c,this.e,this.d)}};_im.G=function(n){this.b=n};_im.G.prototype={b:null,a:function(n,t,i){for(var f=new Array(n.y.length),e=new Array(n.y.length),r=0;r<n.y.length;r++){var u=n.y[r];f[r]=u.c();e[r]=u.g()}var o=$a(t)?null:t.p();var s=this;_a.P.a(this.b.get_mainWindowInstance(),function(n){n.startChat(f,e,o,i)})}};_im.d=function(n){this.j=Function.createDelegate(this,this.l);this.g=Function.createDelegate(this,this.o);this.k=Function.createDelegate(this,this.q);this.f=Function.createDelegate(this,this.m);this.h=Function.createDelegate(this,this.p);_im.d.initializeBase(this,[n]);_im.d.a++;this.e=".ChatMouseView#Handler."+_im.d.a};_im.d.prototype={e:null,b:null,c:null,d:null,a:null,n:function(){if(!this.a)return null;if(!_js.d.a(this.a.m()))return this.a.m();var t=this.a.a();var n=t.y.length;if(n)if(n===1){var i=t.y[0];return String.format(_nbs.a.MY,i.c())}else return String.format(_nbs.a.EQ,n);else return null},J:function(){_js.b.prototype.J.call(this);this.d.dp(!1);this.b.d(100);this.l(null)},Q:function(){_js.c.prototype.Q.call(this);if(!this.E()){if(this.a){this.a.a().e(this.h);this.a.rpcl(_h.f.c.a,this.f)}this.a=null;return}var n=this.E();this.a=n.a;this.a.a().d(this.h);this.a.apcl(_h.f.c.a,this.f);this.a.apcl(_h.f.e.a,this.k)},K:function(){_js.b.prototype.K.call(this);if(!this.F){this.c.rpcl(_b.o.a.a,this.g);$(window).unbind(this.e);this.c=null;this.b=null;this.d=null;return}this.b=this.F.a("TranscriptScrollRegion");this.c=this.F.a("TranscriptLabel");this.d=this.F.a("Editor");this.c.apcl(_b.o.a.a,this.g);$(window).bind("resize"+this.e,this.j);this.i()},i:function(){var n=this.n();_js.d.a(n)||(window.document.title=n)},p:function(n,t){this.i()},m:function(n,t){this.i()},q:function(n,t){if(this.a.t()){var i=this.d.y.children("textarea");i.length>0&&i[0].setAttribute("disabled","true")}},o:function(n,t){var i=this.b.y;var r=i.prop("scrollHeight");i.scrollTop(r-i.height())},l:function(n){var t=$(window).height();t>=425&&this.b.y.height(251+t-425)}};_im._TI=function(){};_im._TI.$$cctor=function(){var n="ChatMouseView";new _A(n,function(){_im._TI.a[n]===undefined&&(_im._TI.a[n]=[null,[[-1,0,["ParticipantsViewModel"],[_im._TI.s],null,"DataContext",null,_im._TI.f,1,null,null,null]],null,[[-1,0,["Chat","BodyText"],[_im._TI.b,_im._TI.p],null,"Html",null,_im._TI.c,1,null,null,null]],[[-1,0,["Chat","LastMessageAriaLabel"],[_im._TI.b,_im._TI.d],null,"Text",null,_im._TI.m,1,null,null,null],[-1,0,["Chat","LastMessageAriaLabel"],[_im._TI.b,_im._TI.d],null,"AriaLabel",null,_im._TI.g,1,null,null,null]],[[-1,0,["Chat","Status"],[_im._TI.b,_im._TI.q],null,"Html",null,_im._TI.c,1,null,null,null]],[[-1,4,null,null,null,"SizingMode",null,_im._TI.o,0,null,null,0,1],[-1,4,null,null,null,"EditorAriaLabel",null,_im._TI.l,0,null,null,null,_u.R.s],[-1,0,["SendCommand"],[_im._TI.t],null,"EnterCommand",null,_im._TI.n,1,null,null,null],[-1,0,["EditorCallContext"],[_im._TI.r],_im._TI.v,"CallContext",_im._TI.h,_im._TI.j,2,null,null,null],[-1,0,["SendText"],[_im._TI.u],_im._TI.w,"Content",_im._TI.i,_im._TI.k,2,null,null,null]]]);var t=_im._TI._hf.childNodes[0].cloneNode(!0);var i=new _zz.g(_B.a(t,[0,3]),_js.a.Instance.a(_y.a),_js.a.Instance.a(_a.e),_js.a.Instance.a(_ff.c),_js.a.Instance.a(_b.e),_js.a.Instance.a(_a.f));i.bH("_im_8 ms-font-weight-regular ms-font-color-black");i.ej(!0);var o=new _b.o(_B.a(t,[0,2,0]),_js.a.Instance.a(_a.f));var s=new _b.bc(_B.a(t,[0,1,1]),_js.a.Instance.a(_ff.c));var r=new _b.o(_B.a(t,[0,1,0]),_js.a.Instance.a(_a.f));var f=new _fce.f(_B.a(t,[0,1]),_js.a.Instance.a(_js.h),_js.a.Instance.a(_ff.a),_js.a.Instance.a(_ff.c));var u=new _js.b(_B.a(t,[0,0,0,0]));u.w("ReadOnlyRecipientWellView");var e=new _fce.f(_B.a(t,[0,0,0]),_js.a.Instance.a(_js.h),_js.a.Instance.a(_ff.a),_js.a.Instance.a(_ff.c));return new _B(t,[e,u,f,r,s,o,i]).R({TranscriptScrollRegion:f,TranscriptLabel:r,Editor:i})},_im.c,_im.d,function(n){return new _im.d(n)},!1,!1,!1,0,_im._TI.a)};_im._TI.e=function(){var n=window.document.createElement("DIV");n.innerHTML="<div> <div class='_im_2'> <div class='_im_3 ms-bg-color-neutralLighter'> <div class='_im_4'> <div></div> </div> </div> <div class='_im_5'> <span></span> <div></div> </div> <div class='_im_6 ms-font-weight-regular ms-font-color-neutralSecondary ms-bg-color-neutralLighter ms-border-color-neutralTertiaryAlt'> <span></span> </div> <div class='_im_7 border-color-transparent ms-border-color-neutralTertiaryAlt-hover'></div> </div> </div>";_js.c.a().appendChild(n);return n};_im._TI.s=function(n){return n.b()};_im._TI.b=function(n){return n.a};_im._TI.p=function(n){return n.l()};_im._TI.d=function(n){return n.S()};_im._TI.q=function(n){return n.u()};_im._TI.t=function(n){return n.g};_im._TI.r=function(n){return n.f};_im._TI.h=function(n){return n.bV};_im._TI.u=function(n){return n.c()};_im._TI.i=function(n){return n.bW()};_im._TI.f=function(n,t){n.X(t)};_im._TI.c=function(n,t){n.a(t)};_im._TI.m=function(n,t){n.a(t)};_im._TI.g=function(n,t){n.W(t)};_im._TI.n=function(n,t){n.dB(t)};_im._TI.v=function(n,t){n.j(t)};_im._TI.j=function(n,t){n.bs(t)};_im._TI.w=function(n,t){n.q(t)};_im._TI.k=function(n,t){n.cB(t)};_im._TI.o=function(n,t){n.ca(t)};_im._TI.l=function(n,t){n.cm=t};_im.n.registerClass("_im.n",_h.dX.$$(Number));_im.u.registerClass("_im.u",_h.dX.$$(Boolean));_im.w.registerClass("_im.w",_h.dX.$$(Number));_im.x.registerClass("_im.x",_h.dX.$$(Number));_im.y.registerClass("_im.y",_h.dX.$$(Number));_im.B.registerClass("_im.B",_h.dX.$$(Number));_im.C.registerClass("_im.C",_h.dX.$$(Number));_im.D.registerClass("_im.D",_h.dX.$$(Number));_im.l.registerClass("_im.l",_a.cX);_im.E.registerClass("_im.E",_h.dX.$$(Number));_im.F.registerClass("_im.F",_h.dX.$$(Number));_im.a.registerClass("_im.a",_js.u,IChatManager,_js.z);_im.e.registerClass("_im.e",_js.u);_im.r.registerClass("_im.r",_js.u);_im.k.registerClass("_im.k",_js.ba,IPresenceManager);_im.j.registerClass("_im.j",_im.k);_im.f.registerClass("_im.f",_js.ba);_im.z.registerClass("_im.z",_im.f);IMComponent.registerClass("IMComponent",null,_a.ih);_im.h.registerClass("_im.h");_im.c.registerClass("_im.c",_a.bx);_im.i.registerClass("_im.i",null,IChatViewModelFactory,_bc.bf);_im.d.registerClass("_im.d",_js.b);_im._TI.registerClass("_im._TI");_im.a.b="SignInState";_im.a.c="IsSignedIn";_im.a.a="Presence";_im.f.a=5e3;IMComponent.$$cctor();_im.c.b=new _H("SendText",String,_im.c,"");_im.c.a=new _H("ParticipantsViewModel",_rw.a,_im.c);_im.d.a=0;_im._TI._hf=_im._TI.e();_im._TI.a={};_im._TI.$$cctor();
window.scriptsLoaded['microsoft.owa.core.im.js'] = 1; window.scriptProcessEnd = window.scriptProcessEnd || {}; window.scriptProcessEnd['microsoft.owa.core.im.js'] = (new Date()).getTime(); } catch(e) { window.owaLastErrorReported = e; throw e; }
