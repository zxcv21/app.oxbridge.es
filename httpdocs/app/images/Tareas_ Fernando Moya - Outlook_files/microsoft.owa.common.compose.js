try { window.scriptsLoaded = window.scriptsLoaded || {}; window.scriptProcessStart = window.scriptProcessStart || {}; window.scriptProcessStart['microsoft.owa.common.compose.js'] = (new Date()).getTime();
Type.registerNamespace("_cmc");_cmc.C=function(n,t){this.e=n;this.c=t};_cmc.C.prototype={e:null,d:function(){return this.e},c:!1,b:function(){return this.c},a:function(n){this.c=n;return n}};_cmc.bb=function(){};_cmc.bb.prototype={k:function(){return!0}};_cmc.F=function(){};_cmc.F.prototype={a:null,b:null,k:function(){return!1}};_cmc.Q=function(){};_cmc.Q.prototype={b:0,a:function(n){this.b=n;return n},k:function(){return!1}};_cmc.R=function(){};_cmc.R.prototype={b:0,a:function(n){this.b=n;return n},k:function(){return!1}};_cmc.d=function(n,t,i){this.s=n;this.n=t;this.p=i};_cmc.d.prototype={n:null,b:function(){return this.n},p:!1,d:function(){return this.p},s:0,a:function(){return this.s},m:!1,j:function(){return this.m},l:!1,h:function(){return this.l},o:!1,g:function(){return this.o},t:!1,e:function(){return this.t},u:null,i:function(){return this.u},k:function(){return!0}};_cmc.G=function(n){this.a=n};_cmc.G.prototype={a:null,k:function(){return!0}};function CommonComposeComponent(){}CommonComposeComponent.$$cctor=function(){_a.r.a().a(CommonComposeComponent)};CommonComposeComponent.prototype={a:function(n,t,i){n.e(_cmc.q).a()},b:function(){return null}};_cmc.e=function(){};_cmc.e.b=function(n,t,i,r,u){var f=new _g.bf;f.BlockStatus=!1;f.ConversationId=n.ConversationId;var e=_a.c.k(_a.c.a());f.DateTimeCreated=e;f.DateTimeReceived=e;f.DateTimeSent=e;var h=t.k();if(h){f.DisplayTo=_cmc.e.a(h.e);f.ToRecipients=h.f()}var s=t.m();if(s){f.DisplayCc=_cmc.e.a(s.e);f.CcRecipients=s.f()}var c=n.ConversationTopic;var o=new _bc.g;f.ExtendedProperty=new Array(3);f.ExtendedProperty[0]=new _g.bk;f.ExtendedProperty[0].ExtendedFieldURI=_g.c.bf();f.ExtendedProperty[0].Value=c;f.ExtendedProperty[1]=new _g.bk;f.ExtendedProperty[1].ExtendedFieldURI=_g.c.W();f.ExtendedProperty[1].Value="3";f.ExtendedProperty[2]=new _g.bk;f.ExtendedProperty[2].ExtendedFieldURI=_g.c.ba();f.ExtendedProperty[2].Value=o.d;f.Flag=new _g.dq;f.Flag.FlagStatus=t.bq()?t.bq().a():"NotFlagged";f.From=i;f.HasAttachments=!!t.S()&&t.S().b()>0;f.HasBlockedImages=t.bh.HasBlockedImages;f.Importance=t.bx();f.InstanceKey="INSK:"+o.a;f.InternetMessageId=t.bh.InternetMessageId;f.IsDeliveryReceiptRequested=undefined===t.bh.IsDeliveryReceiptRequested?!1:t.bh.IsDeliveryReceiptRequested;f.IsDraft=!1;f.IsRead=!0;f.IsReadReceiptRequested=undefined===t.bh.IsReadReceiptRequested?!1:t.bh.IsReadReceiptRequested;f.ItemClass="IPM.Note";f.ItemId=o.b;f.LastModifiedTime=e;f.ParentFolderId=_g.l.a(u).bh.FolderId;f.Preview=t.C().bh.Value;f.ResponseObjects=new Array(3);f.ResponseObjects[0]=new _g.cg;f.ResponseObjects[1]=new _g.bO;f.ResponseObjects[2]=new _g.ce;f.Sender=r;f.Sensitivity=t.bF();f.Subject=_nbs.a.bK+" "+c;f.UniqueBody=new _g.D("HTML",t.C().bh.Value);f.Conversation=n;return f};_cmc.e.c=function(n,t){if(n.y.length>1){var r="";var i=new _js.f;_js.Trace.logInfo(_a.a.a,"[CommonComposeHelper: GetTopItemIdAttachmentsFromConversation] - Getting top attachments from conversations");n.q(function(n){var u=n;if(u.bh.Name){if(r!==u.bh.Name&&(!t||u.bh.ItemId.Id!==t.Id)){i.a(u);r=u.bh.Name}}else _js.Trace.logInfo(_a.a.a,"[CommonComposeHelper: GetTopItemIdAttachmentsFromConversation] - Attachment.Name is null")});return i}else return n};_cmc.e.e=function(n,t){return n.y.length>1&&t.indexOf("ItemId:#Exchange")!==-1};_cmc.e.a=function(n){var t=_cmc.e.d.a(n,!1);_cmc.e.f(t);return t};_cmc.e.f=function(n){!_js.d.a(n)&&n.length>2&&(n=n.substr(0,n.length-2));return n};_cmc.M=function(n,t){this.f=n;this.e=t};_cmc.M.prototype={f:null,d:function(){return this.f},e:null,c:function(){return this.e},b:function(){return!1},a:function(n){return n}};_cmc.y=function(n){this.c=n};_cmc.y.prototype={c:null,d:function(){return this.c},b:function(){return!1},a:function(n){return n}};_cmc.N=function(n,t,i){this.h=n;this.g=t;this.f=i};_cmc.N.prototype={h:null,d:function(){return this.h},g:null,e:function(){return this.g},f:0,c:function(){return this.f},b:function(){return!1},a:function(n){return n}};_cmc.k=function(n,t){this.f=n;this.e=t};_cmc.k.prototype={f:null,d:function(){return this.f},e:null,c:function(){return this.e},b:function(){return!1},a:function(n){return n}};_cmc.r=function(n,t){this.f=n;this.e=t};_cmc.r.prototype={f:null,d:function(){return this.f},e:null,c:function(){return this.e},b:function(){return!1},a:function(n){return n}};_cmc.s=function(n,t){this.f=n;this.e=t};_cmc.s.prototype={f:null,d:function(){return this.f},e:null,c:function(){return this.e},b:function(){return!1},a:function(n){return n}};_cmc.W=function(n,t){this.f=n;this.e=t};_cmc.W.prototype={f:null,d:function(){return this.f},e:0,c:function(){return this.e},b:function(){return!1},a:function(n){return n}};_cmc.X=function(n,t){this.e=n;this.c=t};_cmc.X.prototype={e:null,d:function(){return this.e},c:!1,b:function(){return this.c},a:function(n){this.c=n;return n}};_cmc.Y=function(n,t){this.e=n;this.c=t};_cmc.Y.prototype={e:null,d:function(){return this.e},c:!1,b:function(){return this.c},a:function(n){this.c=n;return n}};_cmc.Z=function(n,t){this.e=n;this.c=t};_cmc.Z.prototype={e:null,d:function(){return this.e},c:!1,b:function(){return this.c},a:function(n){this.c=n;return n}};_cmc.D=function(n,t){this.f=n;this.e=t};_cmc.D.prototype={f:null,e:null,d:function(){return this.f},c:function(){return this.e},b:function(){return!1},a:function(n){return n}};_cmc.E=function(n,t){this.g=n;this.f=t;this.e=!1};_cmc.E.prototype={g:null,f:null,e:!1,d:function(){return this.g},c:function(){return this.f},b:function(){return this.e},a:function(n){this.e=n;return n}};_cmc.P=function(n,t){this.g=n;this.f=t;this.e=!1};_cmc.P.prototype={g:null,d:function(){return this.g},f:null,c:function(){return this.f},e:!1,b:function(){return this.e},a:function(n){this.e=n;return n}};_cmc.z=function(n){this.c=n};_cmc.z.prototype={c:null,d:function(){return this.c},b:function(){return!1},a:function(n){return n}};_cmc.l=function(n,t){this.f=n;this.e=t};_cmc.l.prototype={f:null,d:function(){return this.f},e:0,c:function(){return this.e},b:function(){return!1},a:function(n){return n}};_cmc.B=function(){};_cmc.u=function(n){if(_js.d.a(n))throw Error.argument("coercionType","coercionType cannot be null or empty.");if(n==="text"||n==="html")this.b=n;else throw Error.argument("coercionType","Unsupported coercionType value.");};_cmc.u.prototype={b:null,a:null,k:function(){return!1}};_cmc.c=function(n){this.e=n};_cmc.c.prototype={d:null,c:function(){return this.d},a:function(n){this.d=n;return n},k:function(){return!1},e:!1,b:function(){return this.e}};_cmc.g=function(n){this.b=n};_cmc.g.prototype={b:null,a:function(){return this.b},k:function(){return!0}};_cmc.p=function(n){this.b=n};_cmc.p.prototype={b:!1,a:function(){return this.b},k:function(){return!0}};_cmc.h=function(n){this.a=n};_cmc.h.prototype={a:null,k:function(){return!0}};_cmc.o=function(n){this.a=n};_cmc.o.prototype={a:null,k:function(){return!0}};_cmc.H=function(n,t,i,r,u,f){this.g=n;this.f=t;this.e=i;this.c=r;this.b=u;this.d=f};_cmc.H.prototype={g:null,f:null,e:null,c:null,b:null,a:function(){return this.b},d:null,k:function(){return!0}};_cmc.v=function(n,t,i,r){this.b=n;this.a=t;this.d=i;this.c=r};_cmc.v.prototype={b:null,a:null,d:0,c:0,k:function(){return!0}};_cmc.w=function(n,t,i,r){this.a=n;this.b=t;this.d=i;this.c=r};_cmc.w.prototype={a:null,b:null,d:0,c:0,k:function(){return!0}};_cmc.m=function(n,t,i,r,u){this.c=n;this.e=t;this.a=i;this.d=r;this.b=u};_cmc.m.prototype={c:null,e:null,a:null,d:0,b:null,k:function(){return!0}};_cmc.f=function(n){if(n==="text"||n==="html")this.b=n;else throw Error.argument("coercionType","Unsupported coercionType value.");};_cmc.f.prototype={e:null,b:null,a:null,d:!1,f:function(n){this.d=n;return n},c:function(n){if(n==="subject"||n==="body")this.e=n;else throw Error.argument("sourceProperty","Unsupported sourceProperty value.");return n},k:function(){return!1}};_cmc.i=function(n,t,i){_cmc.i.initializeBase(this,[0,n,i]);this.l=t};_cmc.i.prototype={v:null,q:!1,r:!1,f:function(n){this.r=n;return n},c:function(n){if(n==="subject"||n==="body")this.v=n;else throw Error.argument("sourceProperty","Unsupported sourceProperty value.");return n}};_cmc.I=function(n,t){_cmc.I.initializeBase(this,[3,n,t]);this.l=!1};_cmc.I.prototype={c:!1};_cmc.x=function(){};_cmc.x.prototype={k:function(){return!0}};_cmc.O=function(n,t){this.f=n;this.e=t};_cmc.O.prototype={e:null,c:function(){return this.e},f:null,d:function(){return this.f},b:function(){return!1},a:function(n){return n}};_cmc.t=function(n){this.c=n};_cmc.t.prototype={c:null,d:function(){return this.c},b:function(){return!1},a:function(n){return n}};_cmc.A=function(n,t){this.e=n;this.c=t};_cmc.A.prototype={e:null,c:!1,d:function(){return this.e},b:function(){return this.c},a:function(n){this.c=n;return n}};_cmc.ba=function(n,t,i,r){this.j=n;this.h=t;this.g=i;this.i=r};_cmc.ba.prototype={h:!1,c:function(){return this.h},g:null,e:function(){return this.g},i:!1,f:function(){return this.i},j:null,d:function(){return this.j},b:function(){return!1},a:function(n){return n}};_cmc.V=function(n,t){_cmc.V.initializeBase(this);this.a=n;this.c=t};_cmc.V.prototype={a:null,c:null,b:function(n){if(this.a){var t=this;_js.g.a().a(_a.a.c,"ComposeCopyPasteViewModel.OnAttachViaString",function(){var i=_a.d.b(_a.a.c,"AttachmentCopyAndPasteItemAttachments");t.a.x(n,null,i)},0)}}};_cmc.q=function(){};_cmc.q.prototype={a:function(n,t){return new _cmc.V(n,t)}};_cmc.U=function(){_cmc.U.initializeBase(this);this.c="ComposeUsage"};_cmc.U.prototype={a:function(n){_cmc.bc.prototype.k.call(this,n)}};_cmc.T=function(n,t){_cmc.T.initializeBase(this,[1,t]);this.a.ComposeControl=n};_cmc.T.prototype={b:function(n){this.a.Duration=n},c:function(n){this.a.Total=n}};_cmc.bc=function(){this.m()};_cmc.bc.prototype={b:null,h:null,f:null,l:0,j:0,e:!1,g:null,c:null,k:function(n){if(this.e&&n&&n.length>0){if(n in this.b){var t=this.b[n];this.b[n]=t+1}else this.b[n]=1;this.j++}},i:function(n){this.g=n;this.h=_a.c.get_utcNow();this.e=!0},d:function(){if(this.e){this.f=_a.c.get_utcNow();this.l=this.f.h()-this.h.h();this.n()}this.m()},m:function(){this.b=null;this.b={};this.j=0;this.h=null;this.f=null;this.e=!1},n:function(){if(this.c&&this.g){var n=new _cmc.T(this.g,this.c);n.b(this.l);n.c(this.j);var r=this.b;for(var i in r){var t={key:i,value:r[i]};n.a[t.key]=t.value}_a.k.c.b()&&_a.k.c.a(n)}}};_cmc.b=function(n,t,i,r){this.v=Function.createDelegate(this,this.ct);_cmc.b.initializeBase(this,[n]);this.f=t;this.cd(2);this.U().a(22);n.setAttribute("contenteditable","true");n.setAttribute("spellcheck","true");n.setAttribute("useinlinestyle","true");this.t=r&&r.g()?"rtl":"ltr";n.setAttribute("dir",this.t);n.style.outline="none";this.cq(i.a());this.bH();this.bf(360)};_cmc.b.prototype={f:null,t:null,l:null,bh:!1,b:null,u:!1,o:null,j:null,i:null,k:null,e:function(n){if(n){var i=this.l===n;var t=_y.dz.isInstanceOfType(n)?n.b():!1;this.l=n;t||this.bV(this.l);i||this.bk("CallContext")}return n},cD:function(n){this.bh=n;this.bk("IsInitialized");return n},bs:function(n){this.j||(this.j=new _js.r);this.j.b(n)},cz:function(n){this.j&&this.j.c(n)},bp:function(n){this.i||(this.i=new _js.r);this.i.b(n)},cy:function(n){this.i&&this.i.c(n)},bx:function(n){this.k||(this.k=new _js.r);this.k.b(n)},cB:function(n){this.k&&this.k.c(n)},G:function(){return _a.a.I},g:function(){var n=null;this.E()&&_y.E.isInstanceOfType(this.E())&&(n=this.E().c());return n||window.self},n:function(){this.o||(this.o=new _cmc.n(null));return this.o},cF:function(n){var t=this;this.F(function(t){$(t).css("font-family",_cmc.a.e(n))})},cG:function(n){var t=this;this.F(function(t){$(t).css("font-size",String.format("{0}pt",n))})},bO:function(){this.a("bold",!1,null)},co:function(){this.a("italic",!1,null)},cN:function(){this.a("underline",!1,null)},bW:function(n){this.a("forecolor",!1,n)},bN:function(n){this.a("backcolor",!1,n)},bQ:function(){this.a("insertUnorderedList",!1,null)},cr:function(){this.a("insertOrderedList",!1,null)},bA:function(){this.a("justifyLeft",!1,null)},by:function(){this.a("justifyCenter",!1,null)},bC:function(){this.a("justifyRight",!1,null)},cb:function(){this.a("indent",!1,null)},bS:function(){this.a("outdent",!1,null)},cl:function(n){this.a("createLink",!1,n)},cH:function(){this.a("strikeThrough",!1,null)},cI:function(){this.a("subscript",!1,null)},cJ:function(){this.a("superscript",!1,null)},bR:function(){this.a("removeFormat",!1,null)},cO:function(){this.a("unlink",!1,null)},bT:function(){if(this.f.a()){_js.Trace.logInfo(this.G(),"[ContentEditableDiv: DisableAutoLink] - Disable auto link for IE");this.a("AutoUrlDetect",!1,!1)}},d:function(n){_js.Trace.logInfo(this.G(),"[ContentEditableDiv: ResetSelection] - selectionRange {0} collapsed",n.collapsed?"is":"is not");var t=this.r();t.removeAllRanges();t.addRange(n)},cC:function(n,t){if(n&&this.z(n)){_js.Trace.logInfo(this.G(),"[ContentEditableDiv: ReplaceRangeOfWordWithAnchor] - Range is good, replacing");n.deleteContents();this.w(n,$(t));n.collapse(!1);this.d(n)}},cm:function(){return!!this.q()},V:function(){this.u=!0;var t=_js.c.prototype.V.call(this);this.u=!1;_js.Trace.logInfo(this.G(),"[ContentEditableDiv: Focus] - canFocus: {0}",t?"can focus":"cannot focus");_js.Trace.logInfo(this.G(),"[ContentEditableDiv: Focus] - selectionRangeAtLastBlur: {0}",this.b?"is not null":"is null");if(t&&this.b&&this.z(this.b)){_js.Trace.logInfo(this.G(),"[ContentEditableDiv: Focus] - reset selection to selectionRangeAtLastBlur");this.d(this.b);this.b=null}else if(t&&_a.UserAgent.getInstance().F){_js.Trace.logInfo(this.G(),"[ContentEditableDiv: Focus] - change selection to first P for FireFox");var n=this.q();if(n&&n.startContainer===this.y[0]&&!n.startOffset&&n.endContainer===this.y[0]&&!n.endOffset){var r=this.y.find("p");if(r.length>0){_js.Trace.logInfo(this.G(),"[ContentEditableDiv: Focus] - selection changed to first P for FireFox");var i=r[0];n.setStart(i,0);n.setEnd(i,0);this.d(n)}}}return t},cn:function(n){var i=!1;if(this.p(n))for(var t=n;t&&t!==this.y[0];)if(_js.d.a(t.tagName)||t.tagName.toLowerCase()!=="table")t=t.parentNode;else{i=!0;break}_js.Trace.logInfo(this.G(),"[ContentEditableDiv: IsDescendantOfTableInContentEditableDiv] - element {0} descendantOfTableInCED",i?"is":"is not");return i},c:function(){var n=null;var t=null;try{if(this.h()){_js.Trace.logInfo(this.G(),"[ContentEditableDiv: GetSelectionRange] - has focus, get selection");n=this.q()}else if(this.b){_js.Trace.logInfo(this.G(),"[ContentEditableDiv: GetSelectionRange] - no focus, return the last saved non-null selectionRangeAtLastBlur");n=this.b}else{_js.Trace.logInfo(this.G(),"[ContentEditableDiv: GetSelectionRange] - no focus, no good selectionRangeAtLastBlur, do a temporary focus in CED and try getting selection");t=this.g().document.activeElement;this.y.focus();n=this.q()}}catch(i){_js.Trace.logException(this.G(),i,"[ContentEditableDiv: GetSelectionRange] - Exception encountered in getting selection range")}finally{if(!$a(t)){_js.Trace.logInfo(this.G(),"[ContentEditableDiv: GetSelectionRange] - restore focus to previous focused element");t.focus()}}return n},r:function(){return this.g().getSelection()},m:function(){return this.g().document.createRange()},h:function(){var n=this.g().document.activeElement;return this.p(n)},ca:function(){var n=null;if(this.h()){n=new _cmc.J;var t=this.g().document;var u=t.queryCommandValue("fontname");var r=null;n.l=!_js.d.a(u)&&(r=u.match(_cmc.b.c)).length>1?r[1]:"";n.m=this.bZ();n.n=t.queryCommandState("bold");n.p=t.queryCommandState("italic");n.r=t.queryCommandState("underline");var i=this.Z();n.o=i===1;n.q=i===2}return n},bZ:function(){var t="";var i=null;if(this.h()&&(i=this.r())&&i.focusNode&&this.p(i.focusNode)){var n=i.focusNode;n=n.nodeType===3?n.parentNode:n;while(n){var r=n.style.fontSize;if(r!==""){t=r;break}if(n===this.x)break;n=n.parentNode}}t!==""&&t.endsWith("pt")&&(t=t.substr(0,t.length-2));return t},Z:function(){var i=0;var u=!1;var t=this.c();if(t){var n=t.collapsed?t.startContainer:t.commonAncestorContainer;n=n.nodeType===3?n=n.parentNode:n;while(n&&this.p(n)){var r=n.tagName.toUpperCase();if(u){if(r==="OL"){i=2;break}else if(r==="UL"){i=1;break}}else n.tagName.toUpperCase()==="LI"&&(u=!0);n=n.parentNode}}return i},J:function(){_js.c.prototype.J.call(this);this.y[0].parentNode.appendChild($('<style type="text/css" style="display:none;"><!-- P {margin-top:0;margin-bottom:0;} --></style>')[0]);var n=new _cmc.c(!0);n.d=this.K();this.e(n);this.cD(!0);this.f.a()&&this.y.bind("beforedeactivate",this.v)},O:function(){_js.c.prototype.O.call(this);this.f.a()&&this.y.unbind("beforedeactivate",this.v)},cQ:function(n){var i=n.d();if(i.tagName==="A"&&n.k()){_js.Trace.logInfo(this.G(),"[ContentEditableDiv: OnMouseDown] - mouse clicked on a link");var t=new _cmc.E(this,n.d());this.cx(t);t.e&&this.hH(n)}_js.c.prototype.cQ.call(this,n)},ci:function(n){_js.c.prototype.ci.call(this,n);if(n.a()===8){_js.Trace.logInfo(this.G(),"[ContentEditableDiv: OnKeyDown] - StopPropagation for Backspace");n.c()}},eE:function(n){_js.c.prototype.eE.call(this,n);this.f.a()||this.bo();this.cv(new _cmc.y(this))},F:function(n){this.f.a()&&this.h()||this.V();var t=this.c();t&&(t.collapsed||_a.UserAgent.getInstance().O&&t.toString()===""?this.bI(t,n):this.bL(t,n))},bb:function(n){for(var t=n.parentNode,i=n.nextSibling;!i&&t!==this.x;){i=t.nextSibling;t=t.parentNode}return i},bI:function(n,t){var r=n.startContainer;if(r.nodeType===3&&r.parentNode.tagName.toUpperCase()==="SPAN"&&r.parentNode.textContent.replace(_cmc.b.a,"")==="")t(r.parentNode);else{var i=this.g().document.createElement("span");i.innerHTML="&#8203;";t(i);n.insertNode(i);var u=this.m();u.selectNodeContents(i);u.collapse(!1);this.d(u)}},bL:function(n,t){var l=null;var v=null;var c=n.startContainer;var r=n.endContainer;var a=n.startOffset;var f=n.endOffset;if(c.nodeType===1){c=c.childNodes[a];a=0}if(r.nodeType===1){r=r.childNodes&&f>=0&&f<r.childNodes.length?r.childNodes[f]:this.bb(r);f=0}for(var i=c,e=a;i;){while(i.nodeType===1&&i.childNodes&&i.childNodes.length>0){i=i.childNodes[0];e=0}var w=!r||i===r||(i.compareDocumentPosition(r)&4)==4;if(!w)break;var b=this.bb(i);if(i.nodeType===3){var p=i===r?f:i.nodeValue.length;if(p>e){var u=this.m();u.setStart(i,e);u.setEnd(i,p);if(u.toString()!==""){var o=i.parentNode;var h=null;if(u.toString()===i.nodeValue&&o.tagName.toUpperCase()==="SPAN"&&o.innerText===i.nodeValue){t(o);h=o}else{var s=this.g().document.createElement("span");s.textContent=u.toString();t(s);h=s;u.deleteContents();u.insertNode(s)}l||(l=h);v=h}}}i=b;e=0}if(l&&v){var y=this.m();y.setStartBefore(l);y.setEndAfter(v);this.d(y)}},ct:function(n){this.bo()},bo:function(){var n=this.q();if(n){_js.Trace.logInfo(this.G(),"[ContentEditableDiv: SaveSelectionRangeAtLastBlur] - save selectionRangeAtLastBlur, range {0} collapsed",n.collapsed?"is":"is not");this.b=n}else _js.Trace.logInfo(this.G(),"[ContentEditableDiv: SaveSelectionRangeAtLastBlur] - no selection range, not saving selectionRangeAtLastBlur")},K:function(){var r=!1;var i=this.x;if(!!(!!i.children&i.children.length===1)){var t=i.children[0];t.tagName&&t.tagName.toLowerCase()==="div"&&t.id&&t.id.toLowerCase()==="divtagdefaultwrapper"&&(r=!0)}var n=this.x.innerHTML;r||(n=String.format('<div id="{0}" style="{1}">{2}</div>',"divtagdefaultwrapper",this.n().e(),n));_js.Trace.logInfo(this.G(),"[ContentEditableDiv: GetFullContent] - Remove ZWS");n=n.replace(_cmc.b.a,"");n=String.format('<html><head><meta https-equiv="Content-Type" content="text/html; charset=UTF-8">{0}</head><body dir="{1}">{2}</body></html>','<style type="text/css" style="display:none;"><!-- P {margin-top:0;margin-bottom:0;} --></style>',this.t,n);return n},cw:function(n){this.j&&this.j.a(n)},cv:function(n){this.i&&this.i.a(n)},cx:function(n){this.k&&this.k.a(n)},cL:function(n){if(this.u)_js.Trace.logInfo(this.G(),"[ContentEditableDiv: OnFocus] - selectionRangeAtLastBlur is preserved");else{this.b=null;_js.Trace.logInfo(this.G(),"[ContentEditableDiv: OnFocus] - selectionRangeAtLastBlur is set to null")}this.cw(new _cmc.t(this))},bV:function(n){if(_y.bM.isInstanceOfType(n)){_js.Trace.logInfo(this.G(),"[ContentEditableDiv: ExecuteCall] - IGetContentCallContext");n.a(this.K())}else if(_y.cG.isInstanceOfType(n)){_js.Trace.logInfo(this.G(),"[ContentEditableDiv: ExecuteCall] - ISetContentCallContext");var e=this.bm(n.a());var o=this.bd(e);this.y.html(o)}else if(_y.ds.isInstanceOfType(n)){_js.Trace.logInfo(this.G(),"[ContentEditableDiv: ExecuteCall] - IInsertContentCallContext");var t=n;var i=null;if(t.d()){var f=this.bm(n.b());var r=this.bd(f);i=$("<div>"+r+"</div>").contents()}else{var u=$("<div/>").text(t.b()).html();i=$("<div>"+u+"</div>").contents()}t.a()===1?this.ce(i):t.a()===2?this.bg(i,t.g()):t.a()===3?this.cu(i):this.cf(i,t.j(),t.h())}else if(_y.dx.isInstanceOfType(n)){_js.Trace.logInfo(this.G(),"[ContentEditableDiv: ExecuteCall] - ISetFocusCallContext");this.y.focus()}else throw Error.notImplemented(String.format("[ContentEditableDiv: ExecuteCall] - ContentEditableDiv does not implement CallContext: {0}",Object.getTypeName(this.l)));},bH:function(){var t=this.x;var n=t.style;n.fontSize=String.format("{0}pt",this.n().b);n.color=this.n().c;n.backgroundColor=this.n().d;n.fontFamily=this.n().f()},q:function(){var t=this.r();var i=null;if(t&&t.rangeCount>0)try{var n=t.getRangeAt(0);_js.Trace.logInfo(this.G(),"[ContentEditableDiv: TryGetSelectionRange] - Range {0} collapsed",n.collapsed?"is":"is not");if(this.z(n)){_js.Trace.logInfo(this.G(),"[ContentEditableDiv: TryGetSelectionRange] - Range falls inside CED");i=n}}catch(r){_js.Trace.logInfo(this.G(),"[ContentEditableDiv: TryGetSelectionRange] - Ignoring exception: {0}",r.message)}else _js.Trace.logInfo(this.G(),"[ContentEditableDiv: TryGetSelectionRange] - no selection range");return i},z:function(n){var t=!1;if(!$a(n.commonAncestorContainer)){var i=n.commonAncestorContainer;t=this.p(i)}_js.Trace.logInfo(this.G(),"[ContentEditableDiv: IsRangeInsideContentEditableDiv] - range {0} inside CED",t?"is":"is not");return t},p:function(n){var u=$(n);var i=this.y;var r=u.closest(i);var t=!!r.length;_js.Trace.logInfo(this.G(),"[ContentEditableDiv: IsElementInsideContentEditableDiv] - Element {0} inside CED",t?"is":"is not");return t},w:function(n,t){for(var u=t.get(),e=u.length,i=0;i<e;++i){var r=u[i];_js.Trace.logInfo(this.G(),"[ContentEditableDiv: InsertElementAtRange] - Insert an element");n.collapse(!1);if($a(n.insertNode))$a(n.pasteHTML)||n.pasteHTML(r.innerHTML);else{var f=document.importNode(r,!0);n.insertNode(f);n.setStartAfter(f)}}},bg:function(n,t){var u=this.y.find('div[id^="Signature"]');if(t&&u&&u.length>0){_js.Trace.logInfo(this.G(),"[ContentEditableDiv: InsertElementAtEnd] - Insert above signature");var r=u.get(0);var i=this.m();i.selectNodeContents(r.previousSibling?r.previousSibling:r);i.collapse(!0);this.w(i,n)}else{_js.Trace.logInfo(this.G(),"[ContentEditableDiv: InsertElementAtEnd] - Insert at the end");this.y.append(n)}},ce:function(n){this.y.prepend(n)},cu:function(n){this.y.empty().prepend(n)},cf:function(n,t,i){var r=this.c();if(r){_js.Trace.logInfo(this.G(),"[ContentEditableDiv: InsertElementAtSelection] - insert at selection range");!r.collapsed&&i&&r.deleteContents();var u=r.cloneRange();this.w(r,n);if(t){_js.Trace.logInfo(this.G(),"[ContentEditableDiv: InsertElementAtSelection] - update cursor to after insertion");r.collapse(!1);this.d(r)}else{_js.Trace.logInfo(this.G(),"[ContentEditableDiv: InsertElementAtSelection] - restore to original selection range");this.d(u)}}else{_js.Trace.logInfo(this.G(),"[ContentEditableDiv: InsertElementAtSelection] - on selection, insert at the end");this.bg(n,!0)}},a:function(n,t,i){this.f.a()&&this.h()||this.V();this.g().document.execCommand(n,t,i)},bm:function(n){return n.replace(_cmc.b.d,"$1").replace(_cmc.b.e,"")},bd:function(n){return this.f.a()&&document.documentMode===11?n.replace(_cmc.b.b,"<p>&#8203;</p>"):n},cq:function(n){this.o=new _cmc.n(n)}};_cmc.n=function(n){this.a="Calibri";this.b="12";this.c="#000000";this.d="#FFFFFF";if(n){$a(n.bh.ComposeFontName)||(this.a=n.bh.ComposeFontName);if(!$a(n.bh.ComposeFontSize)){var t=n.bh.ComposeFontSize;this.b=t<_cmc.a.c.length?_cmc.a.c[t]:t.toString()}$a(n.bh.ComposeFontColor)||(this.c=n.bh.ComposeFontColor)}};_cmc.n.prototype={a:null,b:null,c:null,d:null,f:function(){return _cmc.a.e(this.a)},g:function(){return _cmc.a.g(this.a)},e:function(){return String.format("font-size:{0}pt;color:{1};background-color:{2};font-family:{3};",this.b,this.c,this.d,this.f())}};_cmc.J=function(){};_cmc.J.prototype={l:null,c:function(){return this.l},m:null,d:function(){return this.m},n:!1,e:function(){return this.n},p:!1,g:function(){return this.p},r:!1,i:function(){return this.r},o:!1,f:function(){return this.o},q:!1,h:function(){return this.q},k:!1,b:function(){return this.k},j:!1,a:function(){return this.j},s:function(n){return!!n&&this.l===n.c()&&this.m===n.d()&&this.n===n.e()&&this.p===n.g()&&this.r===n.i()&&this.o===n.f()&&this.q===n.h()&&this.k===n.b()&&this.j===n.a()}};_cmc.j=function(n){_cmc.j.initializeBase(this,[n])};_cmc.j.prototype={r:function(n){n&&this.Z(n);return n},Z:function(n){if(_cmc.i.isInstanceOfType(n)){var t=n;if(t.p){t.q=!0;return}var f=t.n?_ff.i.b(t.n):"";var r=this.b;var i=r.substring(0,this.cy())+f+r.substr(this.cx());i=this.cb(i,this.bN);this.c(i)}else if(_cmc.f.isInstanceOfType(n)){var u=n;u.a=this.b.substring(this.cy(),this.cx())}}};_cmc.a=function(){};_cmc.a.e=function(n){for(var i=n,t=0;t<_cmc.a.a.length;++t){var r=_cmc.a.a[t];if(r[0]===i){i=r[1];break}}return i};_cmc.a.g=function(n){for(var r=null,t=0;t<_cmc.a.a.length;++t){var i=_cmc.a.a[t];if(i[0]===n&&i[2]){r=i[2];break}}return r};_cmc.a.f=function(n){for(var r=n,t=0;t<_cmc.a.d.length;++t){var i=_cmc.a.d[t];i[0].toLowerCase()===n.toLowerCase()&&(r=i[1])}return r};_cmc.K=function(n,t){this.f=n;this.e=t};_cmc.K.prototype={e:0,c:function(){return this.e},f:null,d:function(){return this.f},b:function(){return!1},a:function(n){return n}};_cmc.L=function(n,t,i,r,u){this.f=n;this.h=t;this.i=i;this.j=r;this.g=u};_cmc.L.prototype={f:null,a:function(){return this.f},h:0,c:function(){return this.h},i:null,b:function(){return this.i},j:0,e:function(){return this.j},g:0,d:function(){return this.g}};_cmc.S=function(n){this.d=new _ff.d;this.d.c(n)};_cmc.S.prototype={d:null,a:function(){return this.d},W:function(){return!this.d.d.length}};_cmc.bb.registerClass("_cmc.bb",null,_y.eX,_h.dt);_cmc.F.registerClass("_cmc.F",null,_h.dt);_cmc.Q.registerClass("_cmc.Q",null,_y.eM,_h.dt);_cmc.R.registerClass("_cmc.R",null,_y.eN,_h.dt);_cmc.d.registerClass("_cmc.d",null,_y.ds,_h.dt);_cmc.G.registerClass("_cmc.G",null,_h.dt);CommonComposeComponent.registerClass("CommonComposeComponent",null,_a.ih);_cmc.B.registerClass("_cmc.B");_cmc.u.registerClass("_cmc.u",null,_h.dt);_cmc.c.registerClass("_cmc.c",null,_y.bM,_h.dt,_y.dz);_cmc.g.registerClass("_cmc.g",null,_y.cG,_h.dt);_cmc.p.registerClass("_cmc.p",null,_y.dx,_h.dt);_cmc.h.registerClass("_cmc.h",null,_h.dt);_cmc.o.registerClass("_cmc.o",null,_h.dt);_cmc.H.registerClass("_cmc.H",null,_y.hd,_h.dt);_cmc.v.registerClass("_cmc.v",null,_h.dt);_cmc.w.registerClass("_cmc.w",null,_h.dt);_cmc.m.registerClass("_cmc.m",null,_h.dt);_cmc.f.registerClass("_cmc.f",null,_y.hz,_h.dt);_cmc.i.registerClass("_cmc.i",_cmc.d,_y.hz,_h.dt);_cmc.I.registerClass("_cmc.I",_cmc.d,_h.dt);_cmc.x.registerClass("_cmc.x",null,_y.dw,_h.dt);_cmc.V.registerClass("_cmc.V",_a.bx);_cmc.q.registerClass("_cmc.q");_cmc.bc.registerClass("_cmc.bc");_cmc.U.registerClass("_cmc.U",_cmc.bc);_cmc.T.registerClass("_cmc.T",_a.bm);_cmc.b.registerClass("_cmc.b",_js.c);_cmc.J.registerClass("_cmc.J",null,_y.gy);_cmc.j.registerClass("_cmc.j",_fc.h);_cmc.S.registerClass("_cmc.S",null,IOutstandingComposeContext,IContext);CommonComposeComponent.$$cctor();_cmc.e.d=new _y.cq;_cmc.b.b=new RegExp("<p>\\s*</p>","gim");_cmc.b.a=new RegExp("​","gim");_cmc.b.d=new RegExp("(<style[^>]*>)[\\s]*p[\\s]*{[^}]*}","i");_cmc.b.e=new RegExp("}[\\s]*p[\\s]*{[^}]*","gi");_cmc.b.c=new RegExp("^['\"]?([^'\",]*)","i");_cmc.a.a=[["Angsana New","'Angsana New',Serif","'Times'"],["Arial","Arial,Helvetica,sans-serif"],["Arial Black","'Arial Black',Arial,Helvetica,sans-serif","'Helvetica'"],["Calibri","Calibri,Arial,Helvetica,sans-serif"],["Cambria","Cambria,Serif","'Times'"],["Comic Sans MS","'Comic Sans MS',Fantasy,cursive"],["Candara","Candara,Sans-Serif","'Helvetica'"],["Consolas","Consolas,monospace","'Courier'"],["Constantia","Constantia,Serif","'Times'"],["Corbel","Corbel,Sans-Serif","'Helvetica'"],["Cordia New","'Cordia New',Sans-Serif","'Helvetica'"],["Courier New","'Courier New',monospace"],["DaunPenh","DaunPenh,Sans-Serif","'Helvetica'"],["Franklin Gothic Medium","'Franklin Gothic Medium',sans-serif","'Helvetica'"],["Garamond","Garamond,Georgia,serif","'Times'"],["Gautami","Gautami,Sans-Serif","'Helvetica'"],["Georgia","Georgia,serif"],["Gungsuh","Gungsuh,Serif","'Apple Myungjo'"],["Helvetica","Helvetica, Sans-Serif"],["Impact","Impact, Charcoal, sans-serif"],["Iskoola Pota","'Iskoola Pota',Sans-Serif","'Helvetica'"],["Kalinga","Kalinga,Sans-Serif","'Helvetica'"],["Kartika","Kartika,Sans-Serif","'Helvetica'"],["Latha","Latha,Sans-Serif","'Helvetica'"],["Lucida Console","'Lucida Console', Monaco, monospace","'Courier'"],["Lucida Handwriting","'Lucida Handwriting','Comic Sans MS',Fantasy,cursive"],["Lucida Sans Unicode","'Lucida Sans Unicode', 'Lucida Grande', sans-serif","'Helvetica'"],["Mangal","Mangal,Sans-Serif","'Helvetica'"],["Palatino Linotype","'Palatino Linotype', 'Book Antiqua', Palatino, serif"],["Segoe","Segoe,'Segoe UI', Sans-Serif","'Helvetica'"],["Segoe UI","'Segoe UI',Sans-Serif","'Helvetica'"],["Symbol","Symbol,'Segoe UI',Tahoma,Sans-Serif"],["Tahoma","Tahoma, Geneva, sans-serif"],["Times","Times,'Times New Roman',Serif"],["Times New Roman","'Times New Roman', Times, serif"],["Trebuchet MS","'Trebuchet MS', sans-serif"],["Tunga","Tunga,Sans-Serif","'Helvetica'"],["Verdana","Verdana, Geneva, sans-serif"],["Vrinda","Vrinda,Sans-Serif","'Helvetica'"],["Wingdings","Wingdings,Zapf Dingbats"],["黑体","SimHei,'黑体',Sans-Serif","'Heiti SC'"],["微軟正黑體","'Microsoft JhengHei','微軟正黑體',Sans-Serif","'Heiti TC'"],["微软雅黑","'Microsoft YaHei','微软雅黑',Sans-Serif","'Heiti SC'"],["宋体","SimSun,'宋体',Serif","'ST Song'"],["宋体-ExtB","SimSun-ExtB,Serif","'ST Song'"],["新宋体","NSimSun,SimSun,'新宋体',Serif","'ST Song'"],["仿宋","FangSong,'仿宋',Serif","'ST Song'"],["隶书","SimLi,FangSong,'隶书',Serif","'ST Song'"],["楷体","KaiTi,'楷体'，Sans-Serif","'Heiti SC'"],["細明體","MingLiU,'細明體',Serif","'Apple LiSung'"],["細明體_HKSCS","MingLiU_HKSCS,'細明體_HKSCS',Serif","'Apple LiSung'"],["新細明體","PMingLiU,'新細明體',Serif","'Apple LiSung'"],["新細明體-ExtB","PMingLiU-ExtB,'新細明體-ExtB',Serif","'Apple LiSung'"],["標楷體","DFKai-SB,MingLiU,'標楷體',Serif","'Apple LiSung'"],["맑은 고딕","'Malgun Gothic','맑은 고딕',Sans-Serif","'Apple Gothic'"],["굴림","Gulim,'굴림',Sans-Serif","'Apple Gothic'"],["돋움","Dotum,'돋움',Sans-Serif","'Apple Gothic'"],["바탕","Batang,'바탕',Serif","'Apple Myungjo'"],["メイリオ","Meiryo,'メイリオ',Sans-Serif","'Hiragino Kaku Gothic ProN'"],["ＭＳ ゴシック","'MS Gothic','ＭＳ ゴシック',Sans-Serif","'Hiragino Kaku Gothic ProN'"],["ＭＳ Ｐゴシック","'MS PGothic','ＭＳ Ｐゴシック',Sans-Serif","'Hiragino Kaku Gothic ProN'"],["ＭＳ 明朝","'MS Mincho','ＭＳ 明朝',Serif","'Hiragino Mincho ProN'"],["ＭＳ Ｐ明朝","'MS PMincho','ＭＳ Ｐ明朝',Serif","'Hiragino Mincho ProN'"],["Nyala","Nyala,Sans-Serif"],["Raavi","Raavi,Sans-Serif","'Gurmukhi'"],["Shruti","Shruti,Sans-Serif","'Gujarati'"],["Sylfaen","Sylfaen,Serif","'Mshtakan'"]];_cmc.a.d=[["Batang","바탕"],["Dotum","돋움"],["FangSong","仿宋"],["Gulim","굴림"],["Malgun Gothic","맑은 고딕"],["Meiryo","メイリオ"],["Microsoft JhengHei","微軟正黑體"],["Microsoft YaHei","微软雅黑"],["MingLiU","細明體"],["MingLiU_HKSCS","細明體_HKSCS"],["MS Gothic","ＭＳ ゴシック"],["MS Mincho","ＭＳ 明朝"],["MS PGothic","ＭＳ Ｐゴシック"],["MS PMincho","ＭＳ Ｐ明朝"],["PMingLiU","新細明體"],["PMingLiU-ExtB","新細明體-ExtB"],["SimHei","黑体"],["SimSun","宋体"],["SimSun-ExtB","宋体-ExtB"],["KaiTi","楷体"],["DFKai-SB","標楷體"],["SimLi","隶书"],["NSimSun","新宋体"]];_cmc.a.c=["","8","10","12","14","18","24","36"];_cmc.a.b=["8","9","10","11","12","14","16","18","20","22","24","26","28","36","48","72"];
window.scriptsLoaded['microsoft.owa.common.compose.js'] = 1; window.scriptProcessEnd = window.scriptProcessEnd || {}; window.scriptProcessEnd['microsoft.owa.common.compose.js'] = (new Date()).getTime(); } catch(e) { window.owaLastErrorReported = e; throw e; }
